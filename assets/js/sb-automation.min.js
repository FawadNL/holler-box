(function(c,a,d,e){var b={};b.init=function(){b.newVisitor=false;b.noteInteracted=false;b.noteHidden=false;b.checkCookie();if(c.sbAutoVars.active){b.doActive(c.sbAutoVars.active);
}};b.doActive=function(g){for(var f=0;f<g.length;f++){b.doChecks(g[f]);}};b.doChecks=function(k){var h=a.getElementById("sb-"+k);if(!h){return;}var j=c.sbAutoVars[k];
if(!j.visitor){return;}if(j.visitor==="new"&&b.newVisitor!=true){return;}if(j.visitor==="returning"&&b.newVisitor!=false){return;}var g=b.getCookie("sb_"+k+"_shown");
if(j.showSettings==="hide_for"&&g==="true"){return;}else{if(j.showSettings==="hide_for"&&g===""){var i=(j.hideForDays?parseInt(j.hideForDays):1);console.log("hide for "+i);
b.setCookie("sb_"+k+"_shown","true",i);}}b.activeID="sb-"+k;b.activeOptions=j;b.cacheSelectors();b.noteListeners();if(j.display_when!="scroll"){var f=(j.display_when==="delay"?parseInt(j.delay):0);
setTimeout(function(){b.showNote();},f*1000);}else{b.detectScroll();}};b.checkCookie=function(){if(b.getCookie("sb_visit")===""){b.setCookie("sb_visit",Date.now(),parseInt(c.sbAutoVars.expires));
b.setCookie("sb_new","true",1);b.newVisitor=true;}else{if(b.getCookie("sb_new")!=""){b.newVisitor=true;}}console.log("new visitor?"+b.newVisitor);};b.cacheSelectors=function(){b.floatingBtn=a.getElementById("sb-floating-btn");
b.chatBox=a.querySelector("#"+b.activeID+" .sb-chat");b.noteOptin=a.querySelector("#"+b.activeID+" .sb-note-optin");b.firstRow=a.querySelector("#"+b.activeID+" .sb-first-row");
};b.noteListeners=function(){d("body").on("click",".sb-close",b.hideItem).on("click",".sb-email-btn",b.emailSubmitted).on("click","#sb-floating-btn",b.toggleHide).on("click",".sb-interaction",b.interactionLink).on("click",".sb-full-right",b.fullRight).on("click",".sb-text i",b.sendText);
d(".sb-text-input").on("keypress",b.submitChatTextOnEnter);d(".sb-email-input").on("keypress",b.submitEmailOnEnter);};b.detectScroll=function(){d(c).scroll(b.debounce(function(){var g=d(c).scrollTop(),h=d(a).height(),f=d(c).height();
var i=0.5;if((g/(h-f))>i&&!b.show[b.activeID]){b.showNote();b.show[b.activeID]=true;}},250));};b.fullRight=function(){var f=d("#"+b.activeID);f.toggleClass("sb-full-right");
f.toggleClass("sb-minimizing",!f.hasClass("sb-full-right"));setTimeout(function(){f.removeClass("sb-minimizing");},30000);return false;};b.showNote=function(){var f=b.activeOptions;
var h=a.getElementById(b.activeID);b.firstRow.innerHTML=f.content;if(f.hideFirst==="true"||c.localStorage.getItem("sb_hide_note")==="true"){b.transitionOut(h);
if(f.showBtn!="false"){b.transitionIn(b.floatingBtn);}}else{b.transitionIn(h);if(f.showBtn!="false"){b.transitionOut(b.floatingBtn);}}if(f.itemType==="optin"){b.transitionIn(b.noteOptin);
var g=a.querySelector("#"+b.activeID+" .sb-email-input");g.setAttribute("placeholder",f.placeholder);d(".sb-away-msg").remove();d("#"+b.activeID+" .sb-email-row").prepend('<span class="sb-away-msg">'+b.activeOptions.optinMsg+"</span>");
}if(f.showBtn==="false"){b.hide(b.floatingBtn);}if(f.itemType==="chatbox"){b.transitionIn(b.chatBox);}if(f.hide_after==="delay"){setTimeout(function(){b.transitionOut(h);
},parseInt(f.hide_after_delay)*1000);}};b.setCookie=function(g,j,h){var i=new Date();i.setTime(i.getTime()+(h*24*60*60*1000));var f="expires="+i.toUTCString();
a.cookie=g+"="+j+";"+f+";path=/";return j;};b.getCookie=function(h){var g=h+"=";var k=decodeURIComponent(a.cookie);var f=k.split(";");for(var j=0;j<f.length;
j++){var l=f[j];while(l.charAt(0)==" "){l=l.substring(1);}if(l.indexOf(g)==0){return l.substring(g.length,l.length);}}return"";};b.debounce=function(g,f){var h=null;
return function(){var j=this,i=arguments;clearTimeout(h);h=setTimeout(function(){g.apply(j,i);},f);};};b.hideItem=function(f){b.toggleHide();return false;
};b.toggleHide=function(){var f=c.localStorage.getItem("sb_hide_note");if(f==="true"){c.localStorage.removeItem("sb_hide_note");}else{c.localStorage.setItem("sb_hide_note","true");
setTimeout(function(){b.clearChat();},1000);}b.showNote();};b.transitionIn=function(f){f.style.display="block";setTimeout(function(){d(f).addClass("sb-transition-in").removeClass("sb-hide");
},1);setTimeout(function(){d(f).removeClass("sb-transition-in").addClass("sb-show");},100);};b.transitionOut=function(f){d(f).addClass("sb-transition-out").removeClass("sb-show");
setTimeout(function(){d(f).removeClass("sb-transition-out").addClass("sb-hide");f.removeAttribute("style");},500);};b.show=function(f){f.style.display="block";
d(f).removeClass("sb-hide").addClass("sb-show");};b.hide=function(f){d(f).removeClass("sb-show").addClass("sb-hide");f.removeAttribute("style");};b.checkExistingMsg=function(){var h=c.localStorage.getItem("sb-full-msg");
if(h&&h!=""){var g=h.split("/n");for(var f=0;f<g.length;f++){d("#"+b.activeID+" .sb-box-rows").append('<div class="sb-row sb-visitor-row">'+g[f]+"</div>");
}b.showEmailSubmit();}};b.submitChatTextOnEnter=function(f){if(f.target.value&&f.target.value!=""&&f.keyCode==13){b.submitText(f.target.value);f.target.value="";
}};b.submitEmailOnEnter=function(f){if(f.target.value&&f.target.value!=""&&f.keyCode==13){b.emailSubmitted();}};b.sendText=function(f){var g=d("#"+b.activeID+" .sb-text-input").val();
if(g&&g!=""){b.submitText(g);d("#"+b.activeID+" .sb-text-input").val("").focus();}};b.submitText=function(g){var f=c.localStorage.getItem("sb-full-msg");
d("#"+b.activeID+" .sb-box-rows").append('<div class="sb-row sb-visitor-row">'+g+"</div>");if(f){f+="\n"+g;}else{f=g;}c.localStorage.setItem("sb-full-msg",f);
setTimeout(function(){b.showEmailSubmit();},5000);};b.showEmailSubmit=function(){var f=d("#"+b.activeID+" .sb-email-row");if(f.hasClass("sb-show")){return;
}f.removeClass("sb-hide").addClass("sb-show");f.prepend('<span class="sb-away-msg">'+b.activeOptions.optinMsg+"</span>");d("#"+b.activeID+" .sb-email-input").focus();
};b.emailSubmitted=function(h){var f=d("#"+b.activeID+" .sb-email-input").val();if(!f||f.indexOf("@")===-1||f.indexOf(".")===-1){alert("Something is wrong with your email, please try again.");
return;}var g=c.localStorage.getItem("sb-full-msg");b.sendMsg(f,g);};b.sendMsg=function(f,g){d.ajax({method:"GET",url:c.sbAutoVars.ajaxurl,data:{email:f,msg:g,action:"sb_send_email",nonce:c.sbAutoVars.sbNonce}}).done(function(h){console.log(h);
b.clearChat();b.showConfirmation();b.interacted({event:"message_sent"});}).fail(function(h){console.log(h);});};b.clearChat=function(){if(!d(b.chatBox).hasClass("sb-hide")){c.localStorage.removeItem("sb-full-msg");
d("#"+b.activeID+" .sb-visitor-row, #"+b.activeID+" .sb-away-msg").remove();}b.hide(b.noteOptin);};b.interactionLink=function(f){b.interacted({event:"link_clicked",details:{href:f.target.href}});
};b.interacted=function(f){var h=b.activeID.split("-")[1];var g={action:"sb_track_event",nonce:c.sbAutoVars.sbNonce,event:f.event,id:h};if(f.data){g.details=f.details;
}d.ajax({method:"GET",url:c.sbAutoVars.ajaxurl,data:g}).done(function(i){console.log(i);}).fail(function(i){console.log(i);});b.setCookie("sb_note_int","true",1);
};b.showConfirmation=function(){b.firstRow.innerHTML=b.activeOptions.confirmMsg;};b.init();c.sbAutomation=b;})(window,document,jQuery);